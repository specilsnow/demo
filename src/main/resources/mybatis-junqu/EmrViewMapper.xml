<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cdutcm.tcms.junqu.mapper.EmrViewMapper">
  <resultMap id="BaseResultMap" type="com.cdutcm.tcms.junqu.model.EmrView">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 08 14:17:10 CST 2018.
    -->
    <id column="VISIT_NO" jdbcType="DECIMAL" property="visitNo" />
    <result column="VISIT_DATE" jdbcType="TIMESTAMP" property="visitDate" />
    <result column="PATIENT_ID" jdbcType="VARCHAR" property="patientId" />
    <result column="DIAG_DESC" jdbcType="VARCHAR" property="diagDesc" />
    <result column="ILLNESS_DESC" jdbcType="VARCHAR" property="illnessDesc" />
    <result column="ANAMNESIS" jdbcType="VARCHAR" property="anamnesis" />
    <result column="FAMILY_ILL" jdbcType="VARCHAR" property="familyIll" />
    <result column="MARRITAL" jdbcType="VARCHAR" property="marrital" />
    <result column="INDIVIDUAL" jdbcType="VARCHAR" property="individual" />
    <result column="MENSES" jdbcType="VARCHAR" property="menses" />
    <result column="MED_HISTORY" jdbcType="VARCHAR" property="medHistory" />
  </resultMap>
  <resultMap type="com.cdutcm.tcms.biz.model.PatientRegist"  id="patientRegistResult" >
    <id column="pid" property="id" jdbcType="BIGINT" />
    <result column="ys" property="ys" jdbcType="VARCHAR" />
    <result column="ysbm" property="ysbm" jdbcType="VARCHAR" />
    <result column="ghks" property="ghks" jdbcType="VARCHAR" />
    <result column="ghksbm" property="ghksbm" jdbcType="VARCHAR" />
    <result column="patient_no" property="patientNo" jdbcType="VARCHAR" />
    <result column="pvisit_no" property="visitNo" jdbcType="VARCHAR" />
    <result column="kssj" property="kssj" jdbcType="TIMESTAMP" />
    <result column="io" property="io" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="IllnessResult" type="com.cdutcm.tcms.biz.model.IllnessHistory" >
    <result column="id" property="id" jdbcType="BIGINT" />
    <result column="ichief_complaint" property="chiefComplaint" jdbcType="VARCHAR" />
    <result column="present_illness" property="presentIllness" jdbcType="VARCHAR" />
    <result column="passed_illness" property="passedIllness" jdbcType="VARCHAR" />
    <result column="personal_illness" property="personalIllness" jdbcType="VARCHAR" /> 
    <result column="menstruation_History" property="menstruationHistory" jdbcType="VARCHAR" /> 
    <result column="marriage_history" property="marriageHistory" jdbcType="VARCHAR" />
    <result column="allergic_history" property="allergicHistory" jdbcType="VARCHAR" />
    <result column="family_history" property="familyHistory" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="PatientResult" type="com.cdutcm.tcms.biz.model.Patient" >
  	 <id column="cid" property="id" jdbcType="BIGINT" />
    <result column="cpatient_no" property="patientNo" jdbcType="VARCHAR" />
    <result column="cname" property="name" jdbcType="VARCHAR" />
    <result column="sex" property="sex" jdbcType="VARCHAR" />
    <result column="birthday" property="birthday" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="telephone" property="telephone" jdbcType="VARCHAR" />
    <result column="card_no" property="cardNo" jdbcType="VARCHAR" />
    <result column="note" property="note" jdbcType="VARCHAR" />
    <result column="ye" property="ye" jdbcType="INTEGER" />
  </resultMap>
  <resultMap id="BaseEmrMap" type="com.cdutcm.tcms.biz.model.Emr">
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="disease" property="disease" jdbcType="VARCHAR" />
    <result column="symptommould" property="symptommould" jdbcType="VARCHAR" />
    <result column="symptom" property="symptom" jdbcType="VARCHAR" />
    <result column="fs_code" property="fsCode" jdbcType="VARCHAR" />
    <result column="chief_complaint" property="chiefComplaint" jdbcType="VARCHAR" />
    <result column="illness_history_id" property="illnessHistoryId" jdbcType="BIGINT" />
    <result column="bw" property="bw" jdbcType="VARCHAR" />
    <result column="bx" property="bx" jdbcType="VARCHAR" />
    <result column="therapy" property="therapy" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="patient_no" property="patientNo" jdbcType="VARCHAR" />
    <result column="visit_no" property="visitNo" jdbcType="VARCHAR" />
    <result column="patient_name" property="patientName" jdbcType="VARCHAR" />
    <result column="doctor_id" property="doctorId" jdbcType="VARCHAR" />
    <result column="doctor_name" property="doctorName" jdbcType="VARCHAR" />
    <result column="dept_id" property="deptId" jdbcType="VARCHAR" />
    <result column="dept_name" property="deptName" jdbcType="VARCHAR" />
    <result column="dept_name" property="deptName" jdbcType="VARCHAR" />
    <result column="end_time" property="endTime" jdbcType="TIMESTAMP" /> 
    <association column="illnessHistory" property="illnessHistory"  javaType="com.cdutcm.tcms.biz.model.IllnessHistory" resultMap="IllnessResult"/>
    <association column="patient" property="patient"  javaType="com.cdutcm.tcms.biz.model.Patient" resultMap="PatientResult"/>
    <association column="patientRegist" property="patientRegist"  javaType="com.cdutcm.tcms.biz.model.PatientRegist" resultMap="patientRegistResult"/>
    <collection property="recipels" column="recipels" ofType="com.cdutcm.tcms.biz.model.Recipel">
         <result column="recipel_no" property="recipelNo" jdbcType="VARCHAR" />
         <collection column="recipelitem" property="recipelItems"  ofType="com.cdutcm.tcms.biz.model.RecipelItem">
           <result column="reid" property="id" jdbcType="VARCHAR" />
           <result column="rid" property="recipelId" jdbcType="VARCHAR" />
           <result column="name" property="name" jdbcType="VARCHAR" />
           <result column="dosage" property="dosage" jdbcType="VARCHAR" />
           <result column="unit" property="unit" jdbcType="VARCHAR" />
           <result column="usage" property="usage" jdbcType="VARCHAR" />
         </collection>
    </collection>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 08 14:17:10 CST 2018.
    -->
    VISIT_NO, VISIT_DATE, PATIENT_ID, DIAG_DESC, ILLNESS_DESC, ANAMNESIS, FAMILY_ILL, 
    MARRITAL, INDIVIDUAL, MENSES, MED_HISTORY
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 08 14:17:10 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from V_ZYY_OUTP_MR
    where VISIT_NO = #{visitNo,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 08 14:17:10 CST 2018.
    -->
    delete from V_ZYY_OUTP_MR
    where VISIT_NO = #{visitNo,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.cdutcm.tcms.junqu.model.EmrView">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 08 14:17:10 CST 2018.
    -->
    insert into V_ZYY_OUTP_MR (VISIT_NO, VISIT_DATE, PATIENT_ID, 
      DIAG_DESC, ILLNESS_DESC, ANAMNESIS, 
      FAMILY_ILL, MARRITAL, INDIVIDUAL, 
      MENSES, MED_HISTORY)
    values (#{visitNo,jdbcType=DECIMAL}, #{visitDate,jdbcType=TIMESTAMP}, #{patientId,jdbcType=VARCHAR}, 
      #{diagDesc,jdbcType=VARCHAR}, #{illnessDesc,jdbcType=VARCHAR}, #{anamnesis,jdbcType=VARCHAR}, 
      #{familyIll,jdbcType=VARCHAR}, #{marrital,jdbcType=VARCHAR}, #{individual,jdbcType=VARCHAR}, 
      #{menses,jdbcType=VARCHAR}, #{medHistory,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.cdutcm.tcms.junqu.model.EmrView">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 08 14:17:10 CST 2018.
    -->
    insert into V_ZYY_OUTP_MR
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="visitNo != null">
        VISIT_NO,
      </if>
      <if test="visitDate != null">
        VISIT_DATE,
      </if>
      <if test="patientId != null">
        PATIENT_ID,
      </if>
      <if test="diagDesc != null">
        DIAG_DESC,
      </if>
      <if test="illnessDesc != null">
        ILLNESS_DESC,
      </if>
      <if test="anamnesis != null">
        ANAMNESIS,
      </if>
      <if test="familyIll != null">
        FAMILY_ILL,
      </if>
      <if test="marrital != null">
        MARRITAL,
      </if>
      <if test="individual != null">
        INDIVIDUAL,
      </if>
      <if test="menses != null">
        MENSES,
      </if>
      <if test="medHistory != null">
        MED_HISTORY,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="visitNo != null">
        #{visitNo,jdbcType=DECIMAL},
      </if>
      <if test="visitDate != null">
        #{visitDate,jdbcType=TIMESTAMP},
      </if>
      <if test="patientId != null">
        #{patientId,jdbcType=VARCHAR},
      </if>
      <if test="diagDesc != null">
        #{diagDesc,jdbcType=VARCHAR},
      </if>
      <if test="illnessDesc != null">
        #{illnessDesc,jdbcType=VARCHAR},
      </if>
      <if test="anamnesis != null">
        #{anamnesis,jdbcType=VARCHAR},
      </if>
      <if test="familyIll != null">
        #{familyIll,jdbcType=VARCHAR},
      </if>
      <if test="marrital != null">
        #{marrital,jdbcType=VARCHAR},
      </if>
      <if test="individual != null">
        #{individual,jdbcType=VARCHAR},
      </if>
      <if test="menses != null">
        #{menses,jdbcType=VARCHAR},
      </if>
      <if test="medHistory != null">
        #{medHistory,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cdutcm.tcms.junqu.model.EmrView">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 08 14:17:10 CST 2018.
    -->
    update V_ZYY_OUTP_MR
    <set>
      <if test="visitDate != null">
        VISIT_DATE = #{visitDate,jdbcType=TIMESTAMP},
      </if>
      <if test="patientId != null">
        PATIENT_ID = #{patientId,jdbcType=VARCHAR},
      </if>
      <if test="diagDesc != null">
        DIAG_DESC = #{diagDesc,jdbcType=VARCHAR},
      </if>
      <if test="illnessDesc != null">
        ILLNESS_DESC = #{illnessDesc,jdbcType=VARCHAR},
      </if>
      <if test="anamnesis != null">
        ANAMNESIS = #{anamnesis,jdbcType=VARCHAR},
      </if>
      <if test="familyIll != null">
        FAMILY_ILL = #{familyIll,jdbcType=VARCHAR},
      </if>
      <if test="marrital != null">
        MARRITAL = #{marrital,jdbcType=VARCHAR},
      </if>
      <if test="individual != null">
        INDIVIDUAL = #{individual,jdbcType=VARCHAR},
      </if>
      <if test="menses != null">
        MENSES = #{menses,jdbcType=VARCHAR},
      </if>
      <if test="medHistory != null">
        MED_HISTORY = #{medHistory,jdbcType=VARCHAR},
      </if>
    </set>
    where VISIT_NO = #{visitNo,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cdutcm.tcms.junqu.model.EmrView">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 08 14:17:10 CST 2018.
    -->
    update V_ZYY_OUTP_MR
    set VISIT_DATE = #{visitDate,jdbcType=TIMESTAMP},
      PATIENT_ID = #{patientId,jdbcType=VARCHAR},
      DIAG_DESC = #{diagDesc,jdbcType=VARCHAR},
      ILLNESS_DESC = #{illnessDesc,jdbcType=VARCHAR},
      ANAMNESIS = #{anamnesis,jdbcType=VARCHAR},
      FAMILY_ILL = #{familyIll,jdbcType=VARCHAR},
      MARRITAL = #{marrital,jdbcType=VARCHAR},
      INDIVIDUAL = #{individual,jdbcType=VARCHAR},
      MENSES = #{menses,jdbcType=VARCHAR},
      MED_HISTORY = #{medHistory,jdbcType=VARCHAR}
    where VISIT_NO = #{visitNo,jdbcType=DECIMAL}
  </update>
  <select id="findEmrBy" resultMap="BaseEmrMap" parameterType="com.cdutcm.tcms.biz.model.Emr">
   select c.serial_no as id ,b.diag_desc as disease,b.illness_desc as chief_complaint,c.visit_no as visit_no,
       a.patient_id as patientNo,a.name as patient_name,a.doctor as doctor_id, a.dept_name as dept_name,
       a.visit_dept as dept_id,c.visit_date as end_time,c.serial_no as recipel_no,c.serial_no as reid,
       c.serial_no as rid,c.drug_name as name, c.dosage as dosage, c.dosage_units as unit,a.patient_id as patient_no,
       a.visit_no as pvisit_no, a.dept_name as ys,a.dept_name as ghks, a.visit_dept as ghksbm,
       a.patient_id as cpatient_no, a.name as cname, a.sex as sex, a.mailing_address as address, a.phone_number_home as telephone,
       a.date_of_birth as birthday,b.illness_desc as ichief_complaint, b.anamnesis as passed_illness, b.family_ill as family_history,
       b.marrital as marriage_history, b.individual as personal_illness, b.menses as menstruation_History
       from v_zyy_clinic_master a left join v_zyy_outp_mr b on a.visit_no = b.visit_no left join v_zyy_outp_prec  c on c.visit_no = c.visit_no where 1=1
      <if test="createTime != null">
       and c.visit_date = #{createTime,jdbcType=TIMESTAMP}
      </if>
   </select>
    <select id="findEmrBYDateAndNo" resultMap="BaseResultMap" >
     select * from admin.V_ZYY_OUTP_MR t
     where t.visit_date=to_date(#{0},'yyyy-MM-DD') and t.visit_no>#{1}
   </select>
</mapper>